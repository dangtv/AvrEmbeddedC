#include <io.h>
#include <stdlib.h>
#include <stdio.h>
#include <delay.h>
#define THERM_PORT PORTB
#define THERM_DDR DDRB
#define THERM_PIN PINB
#define THERM_IO 0

#define ClearBit(x,y) x &= ~_BV(y) // equivalent to cbi(x,y)
#define SetBit(x,y) x |= _BV(y) // equivalent to sbi(x,y)
#define ReadBit(x,y) x & _BV(y) // call with PINx and bit#

#define THERM_INPUT() ClearBit(THERM_DDR,THERM_IO) // make pin an input
#define THERM_OUTPUT() SetBit(THERM_DDR,THERM_IO) // make pin an output
#define THERM_LOW() ClearBit(THERM_PORT,THERM_IO) // take (output) pin low
#define THERM_HIGH() SetBit(THERM_PORT,THERM_IO) // take (output) pin high
#define THERM_READ() ReadBit(THERM_PIN,THERM_IO) // get (input) pin value

#define THERM_CONVERTTEMP 0x44
#define THERM_READSCRATCH 0xBE
#define THERM_WRITESCRATCH 0x4E
#define THERM_COPYSCRATCH 0x48
#define THERM_READPOWER 0xB4
#define THERM_SEARCHROM 0xF0
#define THERM_READROM 0x33
#define THERM_MATCHROM 0x55
#define THERM_SKIPROM 0xCC
#define THERM_ALARMSEARCH 0xEC

typedef unsigned char byte;

//byte therm_Reset();
//void therm_WriteBit(byte bit);

//byte therm_Reset() {
//    byte i;
//    THERM_OUTPUT(); // set pin as output
//    THERM_LOW(); // pull pin low for 480uS
//    delay_us(480);
//    THERM_INPUT(); // set pin as input
//    delay_us(60); // wait for 60uS
//    i = THERM_READ(); // get pin value
//    delay_us(420); // wait for rest of 480uS period
//    return i;
//}

void therm_WriteBit() {
    THERM_OUTPUT(); // set pin as output
    THERM_LOW(); // pull pin low for 1uS
    delay_us(1);
//    if (bit>0) THERM_INPUT(); // to write 1, float pin
    delay_us(60);
    THERM_INPUT(); // wait 60uS & release pin
}
byte therm_ReadBit();
void therm_WriteByte(byte _data);
byte therm_ReadByte();
void therm_MatchRom(byte _rom[]);
void therm_ReadTempRaw(byte id[], byte *_t0, byte *_t1);

void therm_ReadTempC(byte id[], int *_whole, int *_decimal);
void therm_ReadTempF(byte id[], int *_whole, int *_decimal);
//inline __attribute__((gnu_inline)) void quickDelay(int _delay);
void RomReaderProgram();